<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.ssic.catering.base.mapper.NextWeekCarteExMapper">


	<select id="findAllDistinctDish" resultType="com.ssic.catering.base.dto.NextWeekCarteDtos"
		parameterType="com.ssic.catering.base.dto.NextWeekCarteDtos">
		select DISTINCT
		a.dish_name as dishName,
		a.carte_type_id
		as carteTypeId,
		a.carte_week as carteWeek
		FROM t_ctr_next_week_carte a
		where a.cafetorium_id = #{nextWeekCarteDto.cafetoriumId} and
		a.carte_week = #{nextWeekCarteDto.carteWeek} and
		a.carte_type_id =
		#{nextWeekCarteDto.carteTypeId}
	</select>



	<select id="count" parameterType="com.ssic.catering.base.dto.NextWeekCarteDtos"
		resultType="java.lang.Integer">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Thu Aug 06 
			14:31:54 CST 2015. -->
		select count(*) from t_ctr_next_week_carte
	</select>

	<select id="findNextWeekCarteList" resultType="com.ssic.catering.base.dto.NextWeekCarteDtos">
		select a.id as id,
		a.dish_name as dishName,
		COUNT(a.dish_name) as countDishName,
		a.carte_type_id as crateTypeId,
		a.carte_week as carteWeek
		FROM
		t_ctr_next_week_carte a
		GROUP BY a.carte_week ,
		a.carte_type_id
		,a.dish_name
	</select>

	<select id="findDistinctCarteWeekByCafeId" parameterType="java.lang.String"
		resultType="com.ssic.catering.base.dto.NextWeekCarteDtos">
		SELECT DISTINCT
		t.carte_week as carteWeek,
		t.carte_week_desc
		as carteWeekDesc,
		t.create_time as carteTime
		FROM
		t_ctr_next_week_carte t
		WHERE
		t.cafetorium_id = #{cafetoriumId}
		GROUP BY
		t.carte_week
		ORDER BY
		t.create_time DESC;
	</select>

	<select id="findDishPercent" parameterType="com.ssic.catering.base.dto.NextWeekCarteDtos"
		resultType="java.lang.String">
		SELECT
		CONCAT(
		round(
		(
		SELECT
		count(*)
		FROM
		t_ctr_next_week_carte a
		WHERE
		a.cafetorium_id =
		#{nextWeekCarteDto.cafetoriumId}
		AND a.carte_week =
		#{nextWeekCarteDto.carteWeek}
		AND a.carte_type_id =
		#{nextWeekCarteDto.carteTypeId}
		AND a.dish_name =
		#{nextWeekCarteDto.dishName}
		) / (
		SELECT
		count(*)
		FROM
		t_ctr_next_week_carte a
		WHERE
		a.cafetorium_id =
		#{nextWeekCarteDto.cafetoriumId}
		AND a.carte_week =
		#{nextWeekCarteDto.carteWeek}
		AND a.carte_type_id =
		#{nextWeekCarteDto.carteTypeId}
		 ) * 100))

	</select>
</mapper>